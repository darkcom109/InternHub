{% extends 'base_templates/base.html' %}
{% load static %}

{% block content %}
<style>
    .applied-styling {
        background-color: #E0E7FF;
        color: #3730A3;
    }
    .interview-styling {
        background-color: #FEF9C3;
        color: #854D0E;
    }
    .offer-styling {
        background-color: #DCFCE7;
        color: #166534;
    }
    .rejected-styling {
        background-color: #FEE2E2;
        color: #991B1B;
    }
    .saved-styling {
        background-color: #E5E7EB;
        color: #374151;
    }
    .ghosted-styling {
        background-color: #E5E7EB;
        color: #374151;
    }
    .ghosted-styling {
        background-color: #F3F4F6;
        color: #6B7280;
        font-style: italic;
    }
    .assessment-styling {
        background-color: #FFEDD5;
        color: #9A3412;
    }
</style>

<div class="container py-4">

    <!-- Welcome Header -->
    <div class="d-flex justify-content-center align-items-center mb-4 mt-4">
        <div class="d-flex flex-column align-items-center">
        <h2 class="fw-semibold">Welcome back, {{ request.user.username }} ðŸ‘‹</h2>
        <p class="text-secondary">Hereâ€™s an overview of your internship journey so far.</p>
        </div>
    </div>

    <!-- Stats Section -->
    <div class="row row-cols-1 row-cols-md-3 g-3 mb-4">
        <div class="col">
        <div class="card h-100 bg-dark text-white border-0 shadow-sm p-3 rounded-3" :class="dark ? 'text-black bg-white' : 'text-white bg-dark'">
            <h5 class="fw-semibold mb-1" :class="dark ? 'text-black' : 'text-white'"><i class="bi bi-envelope-paper"></i> Applications Sent</h5>
            <h2 class="fw-bold" :class="dark ? 'text-black' : 'text-white'">{{ stats.total | default:"0" }}</h2>
        </div>
        </div>
        <div class="col">
        <div class="card h-100 bg-dark text-white border-0 shadow-sm p-3 rounded-3" :class="dark ? 'text-black bg-white' : 'text-white bg-dark'">
            <h5 class="fw-semibold mb-1" :class="dark ? 'text-black' : 'text-white'"><i class="bi bi-calendar-check"></i> Interviews Scheduled</h5>
            <h2 class="fw-bold" :class="dark ? 'text-black' : 'text-white'">{{ stats.interview | default:"0" }}</h2>
        </div>
        </div>
        <div class="col">
        <div class="card h-100 bg-dark text-white border-0 shadow-sm p-3 rounded-3" :class="dark ? 'text-black bg-white' : 'text-white bg-dark'">
            <h5 class="fw-semibold mb-1" :class="dark ? 'text-black' : 'text-white'"><i class="bi bi-trophy"></i> Offers Received</h5>
            <h2 class="fw-bold" :class="dark ? 'text-black' : 'text-white'">{{ stats.offer | default:"0" }}</h2>
        </div>
        </div>
    </div>

    <!-- Application Tracker Table -->
    <div class="card shadow-sm" :class="dark ? 'text-white bg-dark' : 'text-black bg-white'">
        <div class="card-body">
        <div class="d-flex justify-content-between align-items-center mb-3">
            <h4 class="fw-semibold mb-0">My Applications</h4>
            <a href="{% url 'add_job' %}" class="btn btn-dark"><i class="bi bi-plus-circle"></i> Add New</a>
        </div>
                {% if jobs %}
                    <div class="table-responsive container-table-styling p-2" :class="dark ? 'bg-dark' : 'bg-light'">
                    <table class="table align-middle">
                    <thead :class="dark ? 'table-dark' : 'table-light'">
                        <tr>
                        <th>Company</th>
                        <th>Role</th>
                        <th>Status</th>
                        <th>Deadline</th>
                        <th>Link</th>
                        <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody :class="dark ? 'table-dark' : 'table-light'">
                    {% for job in jobs %}
                        <tr>
                            <td>{{ job.company }}</td>
                            <td>{{ job.position }}</td>

                            {% if job.status == "applied" %}
                                <td><span class="badge applied-styling">{{ job.status | title }}</span></td>
                            {% elif job.status == "interview" %}
                                <td><span class="badge interview-styling">{{ job.status | title }}</span></td>
                            {% elif job.status == "offer" %}
                                <td><span class="badge offer-styling">{{ job.status | title }}</span></td>
                            {% elif job.status == "rejected" %}
                                <td><span class="badge rejected-styling">{{ job.status | title }}</span></td>
                            {% elif job.status == "saved" %}
                                <td><span class="badge saved-styling">{{ job.status | title }}</span></td>
                            {% elif job.status == "ghosted" %}
                                <td><span class="badge ghosted-styling">{{ job.status | title }}</span></td>
                            {% elif job.status == "assessment" %}
                                <td><span class="badge assessment-styling">{{ job.status | title }}</span></td>
                            {% endif %}
                            
                            <td>{{ job.deadline }}</td>
                            {% if job.link_to_application != "None" %}
                                <td><a href="{{ job.link_to_application }}" target="_blank" class="text-decoration-none">Link to Application</a></td>
                            {% else %}
                                <td>No Link Applied</td>
                            {% endif %}
                            <td>
                                <form action="{% url 'edit_job' job.id %}" style="display:inline;">
                                    {% csrf_token %}
                                    <button type="submit" class="btn btn-sm btn-outline-secondary">
                                        <i class="bi bi-pencil"></i>
                                    </button>
                                </form>
                                <form method="POST" action="{% url 'delete_job' job.id %}" style="display:inline;">
                                    {% csrf_token %}
                                    <button type="submit" class="btn btn-sm btn-outline-danger">
                                        <i class="bi bi-trash"></i>
                                    </button>
                                </form>
                            </td>
                        </tr>
                    {% endfor %}
                    </tbody>
                    </table>
                    </div>
                {% else %}
                    <div class="d-flex justify-content-center p-5">
                        <p class="text-secondary mb-0">You havenâ€™t added any jobs yet. 
                            <a class="text-decoration-none" href="{% url 'add_job' %}">Add one now.</a>
                        </p>
                    </div>
                {% endif %}
        </div>
    </div>

    </div>
{% endblock %}
